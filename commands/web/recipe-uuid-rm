#!/usr/bin/env bash

## Description: Remove UUIDs and _core metadata from Drupal config files.
## Usage: recipe-uuid-rm [path/to/folder]
## Example: ddev recipe-uuid-rm config/sync
## Aliases: recipe:uuid-rm,uuid-rm

#ddev-generated

# Abort if anything fails
set -e

# Check for help flag
if [ "$1" = "--help" ] || [ "$1" = "-h" ] || [ -z "$1" ]; then
    echo -e "\n  ğŸ“  Remove UUIDs and _core metadata from Drupal config files."
    echo -e "\n  ğŸ”¹  Usage: ddev recipe-uuid-rm [path/to/folder]"
    echo -e "\n  ğŸ“–  Example: ddev recipe-uuid-rm config/sync"
    echo -e "\n  ğŸ¯  This command removes uuid: and _core: lines from config files"
    echo -e "      to prepare them for use in Drupal recipes."
    exit 0
fi

# Change to the target directory.
TARGET_DIR="$1"
cd "${TARGET_DIR}" || { echo -e "\n âŒ  Error: Directory '${TARGET_DIR}' not found."; exit 1; }

echo -e "\n ğŸ“‚  Processing files in: ${TARGET_DIR}"

# Remove UUID and metadata lines from all files in the directory
for f in *; do
  if [ -f "$f" ]; then
    echo "\n ğŸ“  Cleaning $f ..."
    sed -i '/^uuid:/d' "$f"
    sed -i '/^_core:/d' "$f"
    sed -i '/^  default_config_hash:/d' "$f"
  fi
done

echo -e "\n âœ…  UUID removal complete."
