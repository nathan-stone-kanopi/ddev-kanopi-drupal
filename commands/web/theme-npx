#!/usr/bin/env bash

## Description: Runs NPX commands on the theme.
## Usage: theme-npx <command> [args...]
## Example: ddev theme-npx webpack --watch
## Aliases: theme:npx

#ddev-generated

# Abort if anything fails
set -e

# Get theme configuration from environment variables
THEME_PATH=$(printenv THEME 2>/dev/null || echo "")
DOCROOT=$(printenv DDEV_DOCROOT 2>/dev/null || echo "web")

# Check if theme is configured and exists
if [ -n "$THEME_PATH" ]; then
    FULL_THEME_PATH="/var/www/html/${DOCROOT}/${THEME_PATH}"

    if [ -d "${FULL_THEME_PATH}" ]; then
        cd "${FULL_THEME_PATH}"
        npx "$@"
    else
        echo "Theme directory not found: ${FULL_THEME_PATH}"
        echo "Please ensure your theme is located at the correct path or update THEME environment variable in .ddev/config.yaml"
        exit 1
    fi
else
    # Run in project root if no theme configured
    npx "$@"
fi
